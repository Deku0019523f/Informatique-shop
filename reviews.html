<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Avis clients</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 30px; }
    .review-form, .reviews {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    }
    .review-entry {
      border-bottom: 1px solid #ddd;
      margin-bottom: 15px;
      padding-bottom: 10px;
    }
    .stars {
      color: gold;
      font-size: 18px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

<div class="review-form">
  <h2>Laisser un avis</h2>
  <input type="text" id="review-name" placeholder="Votre nom" required />
  <input type="email" id="review-email" placeholder="Votre e-mail" required />
  <textarea id="review-message" rows="4" placeholder="Votre message" required></textarea>
  <select id="review-rating">
    <option value="">Note</option>
    <option value="5">★★★★★ - Excellent</option>
    <option value="4">★★★★☆ - Très bien</option>
    <option value="3">★★★☆☆ - Moyen</option>
    <option value="2">★★☆☆☆ - Faible</option>
    <option value="1">★☆☆☆☆ - Mauvais</option>
  </select>
  <button onclick="submitReview()">Envoyer</button>
</div>

<div class="reviews">
  <h3>Avis récents</h3>
  <div id="review-list">Chargement...</div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC2EZx8g3HPjfIC5ELQKdwofNifn3xCgbo",
    authDomain: "informatique-shop-53a25.firebaseapp.com",
    projectId: "informatique-shop-53a25",
    storageBucket: "informatique-shop-53a25.firebasestorage.app",
    messagingSenderId: "1070472171156",
    appId: "1:1070472171156:web:6214bbe7726c12ce666e81",
    measurementId: "G-WCQCBR1CNR"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const list = document.getElementById("review-list");

  function renderReview(doc) {
    const data = doc.data();
    const div = document.createElement("div");
    div.className = "review-entry";
    const stars = "★".repeat(data.rating || 0) + "☆".repeat(5 - (data.rating || 0));
    div.innerHTML = `
      <div class="stars">${stars}</div>
      <strong>${data.name}</strong> (${data.email})<br>
      <p>${data.message}</p>
    `;
    list.prepend(div);
  }

  db.collection("reviews")
    .orderBy("timestamp", "desc")
    .onSnapshot(snapshot => {
      list.innerHTML = "";
      snapshot.forEach(doc => renderReview(doc));
      if (snapshot.empty) list.textContent = "Aucun avis encore.";
    });

  function submitReview() {
    const name = document.getElementById("review-name").value.trim();
    const email = document.getElementById("review-email").value.trim();
    const message = document.getElementById("review-message").value.trim();
    const rating = parseInt(document.getElementById("review-rating").value);

    if (!name || !email || !message || !rating) {
      alert("Veuillez remplir tous les champs.");
      return;
    }

    db.collection("reviews").add({
      name,
      email,
      message,
      rating,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      alert("Merci pour votre avis !");
      document.getElementById("review-name").value = "";
      document.getElementById("review-email").value = "";
      document.getElementById("review-message").value = "";
      document.getElementById("review-rating").value = "";
    }).catch(err => {
      alert("Erreur : " + err.message);
    });
  }
</script>

</body>
</html>
